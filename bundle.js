!function(){"use strict";let t=0;var e=class{constructor(){this.background=null,this.chats=new Map,this.canvasWrapper=document.getElementById("canvas_wrapper"),this.canvas=document.getElementById("result_canvas"),this.context=this.canvas.getContext("2d"),this.anchors=new Map([[1,{x:30,y:30,items:[]}]])}get isDarkOutlineActive(){return r.isActive().tDarkOutline.state}get isDarkChatActive(){return r.isActive().tDarkChat.state}get width(){return this.canvas.width}get height(){return this.canvas.height}setBackground(t){if(this.background=t,this.background&&this.chats.size)return r.isDisabled().resultBtn.remove();r.isDisabled().resultBtn.add()}addChat(t){if(r.isEmpty().loadedFilesWrapper.remove(),this.chats.set(this.chats.size+1,t),this.background&&this.chats.size?r.isDisabled().resultBtn.remove():r.isDisabled().resultBtn.add(),this.chats.size>=4)return r.isLimit().dChatBtn.add();r.isLimit().dChatBtn.remove()}_drawBlurCircle(t,e,i=50){this.context.save(),this.context.filter="blur(30px)",this.context.fillStyle="#000",this.context.beginPath(),this.context.arc(t,e,i,0,2*Math.PI),this.context.fill(),this.context.restore()}_drawDarkOutline(){for(let t=0;t<this.width;t+=75)this._drawBlurCircle(t,-15);for(let t=0;t<this.height+50;t+=75)this._drawBlurCircle(-15,t);for(let t=0;t<this.width;t+=75)this._drawBlurCircle(t,this.height+15);for(let t=0;t<this.height+50;t+=75)this._drawBlurCircle(this.width+15,t)}_drawBackground(){this.context.drawImage(this.background.image,0,0,this.width,this.height)}_drawChats(){if(!this.chats.size)return;const t=1.25;let e=1,i=0;this.isDarkChatActive&&(this.chats.forEach((s=>{const n=this.anchors.get(e),a=n.x,r=n.y+i,d=Math.round(s.image.height/50);for(let t=1;t<d+1;t+=1)for(let e=0;e<s.image.width&&!(e>=s.image.width-75);e+=75)this._drawBlurCircle(a+e,r+35*t,40);i+=s.image.height/t})),e=1,i=0),this.chats.forEach((s=>{const n=this.anchors.get(e),a=n.x,r=n.y+i;this.context.drawImage(s.image,a,r,s.image.width/t,s.image.height/t),n.items.push(s),i+=s.image.height/t}))}_render(){this.context.clearRect(0,0,this.width,this.height),this._drawBackground(),this.isDarkOutlineActive&&this._drawDarkOutline(),this._drawChats()}create(){if(!this.background||!this.chats.size)return;r.isHidden().canvasHolder.remove();const t=this.canvasWrapper.getBoundingClientRect();this.canvas.width=t.width,this.canvas.height=t.height,this._render()}download(){const e=document.createElement("a");t+=1,e.download=`rp_ss_${t}.png`,e.href=this.canvas.toDataURL(),e.click(),e.remove()}};var i=class{constructor(){this.dBackgroundInput=document.getElementById("drop_background_input"),this.dChatInput=document.getElementById("drop_chat_input"),this.dBackgroundBtn=document.getElementById("drop_background_btn"),this.dChatBtn=document.getElementById("drop_chat_btn")}_preventEvents(t){function e(t){t.preventDefault(),t.stopPropagation()}["dragenter","dragover","dragleave","drop"].forEach((i=>{t.addEventListener(i,e,!1)}))}getFileInfo(t,e){const i=e?t:t.files[0];if(!i)return!1;const s=new FileReader;return new Promise((t=>{s.onload=()=>{const e=new Image;e.onload=()=>{t({name:i.name,image:e,data:s.result})},e.src=s.result},s.readAsDataURL(i)}))}getDropFile(t){const e=t.dataTransfer;return!!e?.files&&e.files[0]}_onDBBClick(){this.dBackgroundInput.click()}_onDCBClick(){a.chats.size>=4||this.dChatInput.click()}async _onDBIChange(t){(t=t||await this.getFileInfo(this.dBackgroundInput))&&(r.setBackgroundBtnImage(`url(${t.data})`),a.setBackground(t))}async _onDCIChange(t){a.chats.size>=4||(t=t||await this.getFileInfo(this.dChatInput))&&(r.addLoadedFileToWrapper(t),a.addChat(t))}async _onDrop(t,e){const i=await this.getDropFile(e);if(!i)return;const s=await this.getFileInfo(i,!0);if(t)return this._onDBIChange(s);this._onDCIChange(s)}init(){this._preventEvents(this.dBackgroundBtn),this._preventEvents(this.dChatBtn),this.dBackgroundBtn.addEventListener("click",this._onDBBClick.bind(this),!1),this.dBackgroundInput.addEventListener("change",(()=>this._onDBIChange()),!1),this.dChatBtn.addEventListener("click",this._onDCBClick.bind(this),!1),this.dChatInput.addEventListener("change",(()=>this._onDCIChange()),!1),this.dBackgroundBtn.addEventListener("drop",this._onDrop.bind(this,!0),!1),this.dChatBtn.addEventListener("drop",this._onDrop.bind(this,!1),!1)}};var s=class{constructor(){this.loadedFilesWrapper=document.querySelector(".loaded-files-wrapper"),this.dBackgroundBtn=document.getElementById("drop_background_btn"),this.dChatBtn=document.getElementById("drop_chat_btn"),this.tDarkOutline=document.getElementById("dark_outline"),this.tDarkChat=document.getElementById("dark_chat"),this.canvasHolder=document.getElementById("canvas_holder"),this.resultBtn=document.getElementById("result_btn"),this.elementsKeys=["loadedFilesWrapper","dChatBtn","dBackgroundBtn","dChatBtn","tDarkOutline","tDarkChat","canvasHolder","resultBtn"]}setBackgroundBtnImage(t){this.noFile().dBackgroundBtn.remove(),this.dBackgroundBtn.style.backgroundImage=t}addLoadedFileToWrapper(t){this.loadedFilesWrapper.insertAdjacentHTML("beforeend",`\n        <div class="loaded-file-card">\n            <img class="loaded-file" src="${t.data}">\n        \n            <span>${t.name}</span>\n        </div>\n        `)}isEmpty(){return this._createClassTogglerMethods("is-empty")}isLimit(){return this._createClassTogglerMethods("is-limit")}isActive(){return this._createClassTogglerMethods("is-active")}isHidden(){return this._createClassTogglerMethods("is-hidden")}isDisabled(){return this._createClassTogglerMethods("is-disabled")}noFile(){return this._createClassTogglerMethods("no-file")}_createClassTogglerMethods(t){const e={};return this.elementsKeys.forEach((i=>{var s;e[i]=(s=this[i],{add:()=>s.classList.add(t),remove:()=>s.classList.remove(t),toggle:()=>s.classList.toggle(t),get state(){return s.classList.contains(t.replace(/(\.|\#)/g))}})})),e}};const n=window.fileDropControl=new i,a=window.canvasBuilder=new e,r=window.uiControl=new s;n.init();const d={darkOutline:document.getElementById("dark_outline"),darkChat:document.getElementById("dark_chat")},h=document.getElementById("result_btn"),o=document.getElementById("close_btn"),c=document.getElementById("download_btn");d.darkOutline.addEventListener("click",r.isActive().tDarkOutline.toggle,!1),d.darkChat.addEventListener("click",r.isActive().tDarkChat.toggle,!1),h.addEventListener("click",a.create.bind(a),!1),o.addEventListener("click",r.isHidden().canvasHolder.add,!1),c.addEventListener("click",a.download.bind(a),!1)}();